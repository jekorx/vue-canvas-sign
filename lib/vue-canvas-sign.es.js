import{defineComponent as e,ref as t,computed as o,onMounted as a,openBlock as u,createBlock as l,createVNode as r,renderSlot as n}from"vue";var d=e({name:"CanvasSign",props:{width:{type:Number,default:document.documentElement.clientWidth||document.body.clientWidth},height:{type:Number,default:200},lineWidth:{type:Number,default:2},color:{type:String,default:"#000"},background:{type:String,default:"rgba(255, 255, 255, 0)"},borderWidth:{type:Number,default:1},borderColor:{type:String,default:"#333"},imageType:{type:String,default:"image/png",validator:e=>["image/png","image/jpeg","image/webp"].includes(e)},imageQual:{type:Number,default:.92,validator:e=>e<=1&&e>=0}},setup(e){const u=t(),l=t(),r=t(!1),n=o((()=>e.borderWidth>0&&e.width>2*e.borderWidth?`border: ${e.borderWidth}px solid ${e.borderColor}`:""));return a((()=>{var t;const o=null==(t=u.value)?void 0:t.getContext("2d");if(o){const{background:t,width:a,height:u,color:r,lineWidth:n}=e;o.fillStyle=t,o.fillRect(0,0,a,u),o.strokeStyle=r,o.lineWidth=n,o.lineCap="round",o.lineJoin="round",o.shadowBlur=1,o.shadowColor=r,l.value=o}})),{canvas:u,borderStyle:n,save:t=>{if(!u.value)return void t();let o;o="image/jpeg"===e.imageType?u.value.toDataURL("image/jpeg",e.imageQual):u.value.toDataURL(e.imageType),t(o)},clear:()=>{var e;const{width:t,height:o}=u.value||{};null==(e=l.value)||e.clearRect(0,0,t||0,o||0)},touchstart:e=>{var t,o;const{pageX:a,pageY:u,target:r}=e.changedTouches[0],{tagName:n,offsetTop:d,offsetLeft:i}=r;"CANVAS"===n&&(null==(t=l.value)||t.beginPath(),null==(o=l.value)||o.moveTo(a-i,u-d))},mousedown:e=>{var t,o;const{tagName:a,offsetTop:u,offsetLeft:n}=e.target;"CANVAS"===a&&(r.value=!0,null==(t=l.value)||t.beginPath(),null==(o=l.value)||o.moveTo(e.pageX-n,e.pageY-u))},touchmove:e=>{if(e.stopPropagation(),e.preventDefault(),!l.value)return;const{pageX:t,pageY:o,target:a}=e.changedTouches[0],{tagName:u,offsetTop:r,offsetLeft:n}=a;"CANVAS"===u&&(l.value.lineTo(t-n,o-r),l.value.stroke())},mousemove:t=>{if(t.stopPropagation(),t.preventDefault(),r.value&&u.value&&l.value){const{tagName:o,offsetTop:a,offsetLeft:n}=t.target;if("CANVAS"===o){const{width:o,height:d}=u.value;l.value.lineTo(t.pageX-n,t.pageY-a),l.value.stroke(),(t.pageX-n<=e.borderWidth||t.pageX-n>=(o||0)-2*e.borderWidth||t.pageY-a<=e.borderWidth||t.pageY-a>=(d||0)-2*e.borderWidth)&&(r.value=!1)}}},touchend:()=>{var e;null==(e=l.value)||e.closePath()},mouseup:()=>{var e;r.value=!1,null==(e=l.value)||e.closePath()}}}});d.render=function(e,t,o,a,d,i){return u(),l("div",null,[r("canvas",{ref:"canvas",width:e.width>2*e.borderWidth?e.width-2*e.borderWidth:e.width,height:e.height,style:e.borderStyle,onTouchstart:t[1]||(t[1]=(...t)=>e.touchstart&&e.touchstart(...t)),onMousedown:t[2]||(t[2]=(...t)=>e.mousedown&&e.mousedown(...t)),onTouchmove:t[3]||(t[3]=(...t)=>e.touchmove&&e.touchmove(...t)),onMousemove:t[4]||(t[4]=(...t)=>e.mousemove&&e.mousemove(...t)),onTouchend:t[5]||(t[5]=(...t)=>e.touchend&&e.touchend(...t)),onMouseup:t[6]||(t[6]=(...t)=>e.mouseup&&e.mouseup(...t))},null,44,["width","height"]),n(e.$slots,"default",{save:e.save,clear:e.clear})])},d.install=e=>{e.component(d.name,d)};export default d;
