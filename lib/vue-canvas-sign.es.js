import{defineComponent as e,ref as t,computed as o,onMounted as l,openBlock as a,createBlock as n,createVNode as u,renderSlot as i}from"vue";var r=e({name:"CanvasSign",props:{width:{type:Number,default:document.documentElement.clientWidth||document.body.clientWidth},height:{type:Number,default:200},lineWidth:{type:Number,default:2},color:{type:String,default:"#000"},background:{type:String,default:"rgba(255, 255, 255, 0)"},borderWidth:{type:Number,default:1},borderColor:{type:String,default:"#333"},imageType:{type:String,default:"image/png",validator:e=>["image/png","image/jpeg","image/webp"].includes(e)},imageQual:{type:Number,default:.92,validator:e=>e<=1&&e>=0}},setup(e){const a=t(),n=t(),u=t(!1),i=o((()=>e.borderWidth>0&&e.width>2*e.borderWidth?`border: ${e.borderWidth}px solid ${e.borderColor}`:""));return l((()=>{var t;const o=null==(t=a.value)?void 0:t.getContext("2d");if(o){const{background:t,width:l,height:a,color:u,lineWidth:i}=e;o.fillStyle=t,o.fillRect(0,0,l,a),o.strokeStyle=u,o.lineWidth=i,o.lineCap="round",o.lineJoin="round",o.shadowBlur=1,o.shadowColor=u,n.value=o}})),{canvas:a,borderStyle:i,save:t=>{if(!a.value)return void t();let o;o="image/jpeg"===e.imageType?a.value.toDataURL("image/jpeg",e.imageQual):a.value.toDataURL(e.imageType),t(o)},clear:()=>{var e;const{width:t,height:o}=a.value||{};null==(e=n.value)||e.clearRect(0,0,t||0,o||0)},touchstart:e=>{var t,o,l;const{clientX:u,clientY:i,target:r}=e.changedTouches[0],{tagName:d}=r;if("CANVAS"===d){const{left:e,top:r}=(null==(t=a.value)?void 0:t.getBoundingClientRect())||{left:0,top:0};null==(o=n.value)||o.beginPath(),null==(l=n.value)||l.moveTo(u-e,i-r)}},mousedown:e=>{var t,o,l;const{tagName:i}=e.target;if("CANVAS"===i){const{left:i,top:r}=(null==(t=a.value)?void 0:t.getBoundingClientRect())||{left:0,top:0};u.value=!0,null==(o=n.value)||o.beginPath(),null==(l=n.value)||l.moveTo(e.clientX-i,e.clientY-r)}},touchmove:e=>{var t;if(e.stopPropagation(),e.preventDefault(),!n.value)return;const{clientX:o,clientY:l,target:u}=e.changedTouches[0],{tagName:i}=u;if("CANVAS"===i){const{left:e,top:u}=(null==(t=a.value)?void 0:t.getBoundingClientRect())||{left:0,top:0};n.value.lineTo(o-e,l-u),n.value.stroke()}},mousemove:t=>{if(t.stopPropagation(),t.preventDefault(),u.value&&a.value&&n.value){const{tagName:o}=t.target;if("CANVAS"===o){const{width:o,height:l}=a.value,{left:i,top:r}=a.value.getBoundingClientRect()||{left:0,top:0};n.value.lineTo(t.clientX-i,t.clientY-r),n.value.stroke(),(t.clientX-i<=e.borderWidth||t.clientX-i>=(o||0)-2*e.borderWidth||t.clientY-r<=e.borderWidth||t.clientY-r>=(l||0)-2*e.borderWidth)&&(u.value=!1)}}},touchend:()=>{var e;null==(e=n.value)||e.closePath()},mouseup:()=>{var e;u.value=!1,null==(e=n.value)||e.closePath()}}}});r.render=function(e,t,o,l,r,d){return a(),n("div",null,[u("canvas",{ref:"canvas",width:e.width>2*e.borderWidth?e.width-2*e.borderWidth:e.width,height:e.height,style:e.borderStyle,onTouchstart:t[1]||(t[1]=(...t)=>e.touchstart&&e.touchstart(...t)),onMousedown:t[2]||(t[2]=(...t)=>e.mousedown&&e.mousedown(...t)),onTouchmove:t[3]||(t[3]=(...t)=>e.touchmove&&e.touchmove(...t)),onMousemove:t[4]||(t[4]=(...t)=>e.mousemove&&e.mousemove(...t)),onTouchend:t[5]||(t[5]=(...t)=>e.touchend&&e.touchend(...t)),onMouseup:t[6]||(t[6]=(...t)=>e.mouseup&&e.mouseup(...t))},null,44,["width","height"]),i(e.$slots,"default",{save:e.save,clear:e.clear})])},r.install=e=>{e.component(r.name,r)};export default r;
